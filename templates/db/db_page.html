{% extends "base.html" %}
{% block script %}
<script type="text/javascript">
	$(document).ready(function(){
		content = "";
		column = "";

		$('.cell').focusin(function(e){
			content = $(this).html();
		});
		
		$('.cell').focusout(function(e){
			if (content != $(this).html()){
				id = $(this).attr('id').split("::");
				row = id[0];
				col = id[1];
				$.ajax({
					type: "POST",
					url: document.URL,
					data: {'cell': 'cell', 'group': '{{ g.title }}', 'db_name': '{{ db.name }}', 'row': row, 'col': col, 'content': $(this).html()},
					success: function(data){
					},
					error: function(xhr, ajaxOptions, errorThrown){
					}
				});
				return false;
			}
		});

		$('.column').focusin(function(e){
			column = $(this).html();
		});

		$('.column').focusout(function(e){
			if (column != $(this).html()){
				id = $(this).attr('id').split('_');
				num = id[1];
				$.ajax({
					type: "POST",
					url: document.URL,
					data: {'col': 'col', 'group': '{{ g.title }}', 'db_name': '{{ db.name }}', 'num': num, 'content': $(this).html()}, 
					success: function(data){
					},
					error: function(xhr, ajaxOptions, errorThrown){
					}
				});
				return false;
			}
		});
	});	
</script>
{% endblock %}
{% block wrapper %}
		<div id = "dbnamefield">
			<span id = "dbname">DBëª…: {{ db.name }}</span>
		</div>

		<div id = "dbfield">	
			<table border = "1" id = "mydb">
				<tr>
				{% for col in preset %}
					{% if not forloop.first %}
						<th><div id="col_{{ forloop.counter0 }}"class="column" height="30" contenteditable="true">{{ col }}</div></th>
					{% else %}
						<th height="30"></th>
					{% endif %}
				{% endfor %}
				</tr>
				{% for r in cells %}
				<tr>
					<th width="30" height="30">
						<div id="row{{ forloop.counter }}">{{ forloop.counter }}</div>
					</th>
					{% for c in r %}
					<td width="100" height="30">
						<div id= "{{ c.rownum }}::{{ c.colnum }}" class="cell" {% if c.editable == True %}contenteditable="true"{% endif %}>
						{% if c.contents == NONE %}
						{% else %} 
						{{ c.contents }}
						{% endif %}
						</div>
					</td>
					{% endfor %}
				</tr>
				{% endfor %}
			</table>
		</div>
{% endblock %} 
